@model GSTSMSLibrary.Secretary.Secretary
@{
    ViewBag.Title = "VisitorShowAU";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no" name="viewport">

    <title>Visitor Report</title>

    <link rel="stylesheet" href="https://cdn.datatables.net/2.2.2/css/dataTables.dataTables.css">


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>


    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">
    <link href="~/Content/css/VisitorManagementAU.css" rel="stylesheet" />



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <script src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <link rel="stylesheet" href="~/Content/modules/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="~/Content/modules/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="~/Content/modules/daterangepicker/daterangepicker.css">
    <link rel="stylesheet" href="~/Content/modules/datatables/datatables.min.css">
    <link rel="stylesheet" href="~/Content/modules/datatables/DataTables-1.10.16/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="~/Content/modules/datatables/Select-1.2.4/css/select.bootstrap4.min.css">
    <link rel="stylesheet" href="~/Content/css/style.css">
    <link rel="stylesheet" href="~/Content/css/components.css">

    <style>
        .gap-2 {
            gap: 0.5rem !important; /* Reduce space between date & reset */
        }

        /* Table Styling */
        .table-responsive {
            overflow-x: auto;
        }

        table {
            border-collapse: collapse;
            /width: 100%;
            / border: none !important;
        }

            table thead th {
                background-color: darkgray !important;
                color: white !important;
                font-weight: 600;
                border: none !important;
                padding: 15px 7px !important;
            }


            table tbody td {
                border: none !important;
                padding: 5px 7px !important;
            }

            table.dataTable tbody tr {
                border-bottom: none !important;
            }

                table.dataTable tbody tr:hover {
                    background-color: #f5f5f5;
                }

        /* Adjust Export Icons and Search Box */
        .dt-buttons .btn {
            padding: 4px 10px;
            margin-right: 4px;
        }

        .dataTables_filter input {
            padding: 4px 6px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        /* ICON BUTTONS */
        .dt-icon-button {
            background: transparent !important;
            border: none !important;
            /box-shadow: none !important;
            / padding: 0 2px;
            margin: 0 2px;
            cursor: pointer;
        }

        .export-icons {
            margin-bottom: 10px; /* adjust value as needed */
        }

    </style>

</head>
<body>
    <div class="main-content">
        <section class="section">
            <form id="filterForm">

                <div class="row mb-3">
                    <div class="col-md-6 d-flex align-items-end">
                        <div class="d-flex align-items-center">
                            <a href="javascript:;" class="btn btn-primary daterange-btn icon-left btn-icon mr-2" id="dateRangeBtn">
                                <i class="fas fa-calendar"></i> <span>Select Date</span>
                            </a>

                            <button type="button" class="btn btn-light border d-flex align-items-center" onclick="location.reload();">
                                <i class="fas fa-sync-alt mr-2"></i> Reset
                            </button>
                        </div>

                        <input type="hidden" id="fromDate1" />
                        <input type="hidden" id="toDate1" />
                    </div>
                </div>


                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped" id="table-1">
                                        <thead>
                                            <tr>
                                                <th><input type="checkbox" id="selectAll"></th>
                                                <th>Sr. No</th>
                                                <th>Visitor Name</th>
                                                <th>Visitor Type</th>
                                                <th>Owner Name</th>
                                                <th>Vehicle Number</th>
                                                <th>Flat No</th>
                                                <th>Visitor Contact</th>
                                                <th>Check in</th>
                                                <th>Check out</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @{ int serialNumber = 1; }
                                            @foreach (var user in Model.LstOfWorker)
                                            {
                                                <tr>
                                                    <td><input type="checkbox" class="rowCheckbox" value="@user.VisitorName" /></td>
                                                    <td>@serialNumber</td>
                                                    <td>@user.VisitorName</td>
                                                    <td>@user.Reason</td>
                                                    <td>@(string.IsNullOrEmpty(user.FullName) ? "-" : user.FullName)</td>
                                                    <td>@(string.IsNullOrEmpty(user.VehicleNumber) ? "-" : user.VehicleNumber)</td>
                                                    <td>@(string.IsNullOrEmpty(user.FlatCode) ? "-" : user.FlatCode)</td>
                                                    <td>@user.VisitorContact</td>
                                                    <td>@user.CheckIn</td>
                                                    <td class="checkout-time">@(user.CheckOut.HasValue ? user.CheckOut.Value.ToString("dd-MM-yyyy hh:mm:ss tt") : "-")</td>
                                                    <td>@user.Status</td>
                                                </tr>
                                                serialNumber++;
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </section>
    </div>




    <script src="~/Content/modules/
            "></script>
    <script src="~/Content/modules/bootstrap/js/bootstrap.min.js"></script>
    <script src="~/Content/modules/moment.min.js"></script>
    <script src="~/Content/modules/daterangepicker/daterangepicker.js"></script>






    <script src="~/Content/modules/popper.js"></script>
    <script src="~/Content/modules/tooltip.js"></script>

    <script src="~/Content/modules/nicescroll/jquery.nicescroll.min.js"></script>

    <script src="~/Content/js/stisla.js"></script>

    <!-- JS Libraies -->
    <script src="~/Content/modules/datatables/datatables.min.js"></script>
    <script src="~/Content/modules/datatables/DataTables-1.10.16/js/dataTables.bootstrap4.min.js"></script>
    <script src="~/Content/modules/datatables/Select-1.2.4/js/dataTables.select.min.js"></script>
    <script src="~/Content/modules/jquery-ui/jquery-ui.min.js"></script>



    <!-- Template JS File -->
    <script src="~/Content/js/scripts.js"></script>
    <script src="~/Content/js/custom.js"></script>

    <!-- Buttons JS -->
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Moment.js -->
    <script src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>

    <script>
        $(document).ready(function () {
            var table = $('#table-1').DataTable({
                paging: true,
                dom: 'Bfrtip',
                buttons: [
                    {
                        extend: 'copyHtml5',
                        text: '<img src="/Content/img/copy.png" /> Copy',
                        className: 'dt-btn-icon',
                        exportOptions: {
                            columns: ':not(.noExport)',
                            rows: function (idx, data, node) {
                                return $(node).find('.rowCheckbox').is(':checked');
                            }
                        },
                        action: function (e, dt, button, config) {
                            if (!hasSelection(dt)) {
                                alert("Please select at least one row to export.");
                                return;
                            }
                            $.fn.dataTable.ext.buttons.copyHtml5.action.call(this, e, dt, button, config);
                        }
                    },
                    {
                        extend: 'csvHtml5',
                        text: '<img src="/Content/img/csv.png" /> CSV',
                        className: 'dt-btn-icon',
                        exportOptions: {
                            columns: ':not(.noExport)',
                            rows: function (idx, data, node) {
                                return $(node).find('.rowCheckbox').is(':checked');
                            }
                        },
                        action: function (e, dt, button, config) {
                            if (!hasSelection(dt)) {
                                alert("Please select at least one row to export.");
                                return;
                            }
                            $.fn.dataTable.ext.buttons.csvHtml5.action.call(this, e, dt, button, config);
                        }
                    },
                    {
                        extend: 'excelHtml5',
                        text: '<img src="/Content/img/excel.png" /> Excel',
                        className: 'dt-btn-icon',
                        exportOptions: {
                            columns: ':not(.noExport)',
                            rows: function (idx, data, node) {
                                return $(node).find('.rowCheckbox').is(':checked');
                            }
                        },
                        action: function (e, dt, button, config) {
                            if (!hasSelection(dt)) {
                                alert("Please select at least one row to export.");
                                return;
                            }
                            $.fn.dataTable.ext.buttons.excelHtml5.action.call(this, e, dt, button, config);
                        }
                    },
                    {
                        extend: 'pdfHtml5',
                        text: '<img src="/Content/img/pdf.png" /> PDF',
                        className: 'dt-btn-icon',
                        exportOptions: {
                            columns: ':not(.noExport)',
                            rows: function (idx, data, node) {
                                return $(node).find('.rowCheckbox').is(':checked');
                            }
                        },
                        customize: function (doc) {
                            doc.content.splice(0, 0, {
                                text: 'Visitor Record',
                                alignment: 'center',
                                fontSize: 14,
                                bold: true,
                                margin: [0, 0, 0, 12]
                            });

                            var now = new Date();
                            var formatted = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
                            doc.footer = function () {
                                return {
                                    columns: [
                                        { text: '' },
                                        { text: formatted, alignment: 'right', margin: [0, 0, 10, 0] }
                                    ]
                                };
                            };
                        },
                        action: function (e, dt, button, config) {
                            if (!hasSelection(dt)) {
                                alert("Please select at least one row to export.");
                                return;
                            }
                            $.fn.dataTable.ext.buttons.pdfHtml5.action.call(this, e, dt, button, config);
                        }
                    },
                    {
                        extend: 'print',
                        text: '<img src="/Content/img/print.png" /> Print',
                        className: 'dt-btn-icon',
                        exportOptions: {
                            columns: ':not(.noExport)',
                            rows: function (idx, data, node) {
                                return $(node).find('.rowCheckbox').is(':checked');
                            }
                        },
                        customize: function (win) {
                            $(win.document.body).prepend(
                                '<h3 style="text-align:center">Visitor Record</h3>'
                            );
                            $(win.document.body).append(
                                '<div style="text-align:right; font-size:10px;">' + new Date().toLocaleString() + '</div>'
                            );
                        },
                        action: function (e, dt, button, config) {
                            if (!hasSelection(dt)) {
                                alert("Please select at least one row to export.");
                                return;
                            }
                            $.fn.dataTable.ext.buttons.print.action.call(this, e, dt, button, config);
                        }
                    }
                ]
            });

            // Master checkbox
            $('#selectAll').on('change', function () {
                var isChecked = $(this).is(':checked');
                table.rows().every(function () {
                    var row = this.node();
                    $(row).find('.rowCheckbox').prop('checked', isChecked);
                });
            });

            // Auto update master checkbox
            $('#table-1 tbody').on('change', '.rowCheckbox', function () {
                var all = table.rows().nodes().to$().find('.rowCheckbox').length;
                var checked = table.rows().nodes().to$().find('.rowCheckbox:checked').length;
                $('#selectAll').prop('checked', all === checked);
            });

            // Selection checker
            function hasSelection(dt) {
                return dt.rows().nodes().to$().find('.rowCheckbox:checked').length > 0;
            }
        });
    </script>



    <script>
        $(document).ready(function () {
            var table = $('#table-1').DataTable();

            // Custom filter by date
            $.fn.dataTable.ext.search.push(
                function (settings, data, dataIndex) {
                    var min = moment($('#fromDate1').val(), "YYYY-MM-DD");
                    var max = moment($('#toDate1').val(), "YYYY-MM-DD");
                    var checkIn = moment(data[8], "DD-MM-YYYY hh:mm:ss A");

                    if (!checkIn.isValid()) return false;
                    if ((min == null && max == null) ||
                        (min == null && checkIn <= max) ||
                        (min <= checkIn && max == null) ||
                        (min <= checkIn && checkIn <= max)) {
                        return true;
                    }
                    return false;
                }
            );

            function setRange(start, end) {
                $('#dateRangeBtn span').html(start.format('MMM D, YYYY') + ' - ' + end.format('MMM D, YYYY'));
                $('#fromDate1').val(start.format('YYYY-MM-DD'));
                $('#toDate1').val(end.format('YYYY-MM-DD'));
            }

            var start = moment().startOf('month');
            var end = moment();
            setRange(start, end);
            table.draw();

            $('#dateRangeBtn').daterangepicker({
                startDate: start,
                endDate: end,
                opens: 'right',
                autoUpdateInput: false,
                locale: {
                    applyLabel: 'Apply',
                    cancelLabel: 'Cancel'
                },
                ranges: {
                    'Today': [moment(), moment()],
                    'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                    'Last 7 Days': [moment().subtract(6, 'days'), moment()],
                    'Last 30 Days': [moment().subtract(29, 'days'), moment()],
                    'This Month': [moment().startOf('month'), moment().endOf('month')],
                    'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                }
            });

            $('#dateRangeBtn').on('apply.daterangepicker', function (ev, picker) {
                setRange(picker.startDate, picker.endDate);
                table.draw();
            });

            $('#dateRangeBtn').on('cancel.daterangepicker', function () {
                $('#dateRangeBtn span').html('Select Date');
                $('#fromDate1').val('');
                $('#toDate1').val('');
                table.draw();
            });
        });
    </script>



</body>
</html>



